@let message = kcContext.message;
@let auth = kcContext.auth;
@let isAppInitiatedAction = kcContext.isAppInitiatedAction;
@let url = kcContext.url;
@let isReadyToRender = isReadyToRender$ | async;

@if (isReadyToRender) {
  <div style="display: flex; height: 100vh">
    <!-- Sección izquierda (formulario) -->
    <div
      style="
        width: 48%;
        background: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 80vh;
      "
    >
      <div
        [kcClass]="'kcLoginClass'"
        style="flex: 1; display: flex; flex-direction: column"
      >
        <!-- Contenido actual de login -->
        <div [kcClass]="'kcLoginClass'">
          <div [kcClass]="'kcFormCardClass'">
            <header [kcClass]="'kcFormHeaderClass'">
              <!-- Locale switcher -->
              @if (i18n.enabledLanguages.length > 1) {
                <div
                  id="kc-locale"
                  [kcClass]="'kcLocaleMainClass'"
                >
                  <div
                    id="kc-locale-wrapper"
                    [kcClass]="'kcLocaleWrapperClass'"
                  >
                    <div
                      id="kc-locale-dropdown"
                      class="menu-button-links"
                      [kcClass]="'kcLocaleDropDownClass'"
                    >
                      <button
                        tabindex="1"
                        id="kc-current-locale-link"
                        aria-haspopup="true"
                        aria-expanded="false"
                        aria-controls="language-switch1"
                        [attr.aria-label]="i18n.msgStr('languages')"
                      >
                        {{ i18n.currentLanguage.label }}
                      </button>
                      <ul
                        role="menu"
                        tabindex="-1"
                        aria-labelledby="kc-current-locale-link"
                        aria-activedescendant=""
                        id="language-switch1"
                        [kcClass]="'kcLocaleListClass'"
                      >
                        @for (entry of i18n.enabledLanguages; track entry; let idx = $index) {
                          <li
                            role="none"
                            [kcClass]="'kcLocaleListItemClass'"
                          >
                            <a
                              role="menuitem"
                              tabindex="-1"
                              [href]="entry.href"
                              [kcClass]="'kcLocaleItemClass'"
                              [id]="'language-' + idx"
                            >
                              {{ entry.label }}
                            </a>
                          </li>
                        }
                      </ul>
                    </div>
                  </div>
                </div>
              }

              <!-- Header content -->
              <ng-template #node>
                @if (auth && !auth.showUsername && !auth.showResetCredentials) {
                  <h1 id="kc-page-title">
                    @let header = headerNode && headerNode();
                    @if (header) {
                      <ng-container [ngTemplateOutlet]="header" />
                    }
                  </h1>
                } @else {
                  <div
                    id="kc-username"
                    [kcClass]="'kcFormGroupClass'"
                  >
                    <label id="kc-attempted-username">{{ auth?.attemptedUsername }}</label>
                    <a
                      id="reset-login"
                      [href]="url?.loginRestartFlowUrl"
                      [attr.aria-label]="i18n.msgStr('restartLoginTooltip')"
                    >
                      <div class="kc-login-tooltip">
                        <i [kcClass]="'kcResetFlowIcon'"></i>
                        <span class="kc-tooltip-text">
                          {{ i18n.msgStr('restartLoginTooltip') }}
                        </span>
                      </div>
                    </a>
                  </div>
                }
              </ng-template>

              @if (displayRequiredFields) {
                <div [kcClass]="'kcContentWrapperClass'">
                  <div
                    class="subtitle"
                    [kcClass]="'kcLabelWrapperClass'"
                  >
                    <span class="subtitle">
                      <span class="required">*</span>
                      {{ i18n.msgStr('requiredFields') }}
                    </span>
                  </div>
                  <div class="col-md-10">
                    <ng-container [ngTemplateOutlet]="node" />
                  </div>
                </div>
              } @else {
                <ng-container [ngTemplateOutlet]="node" />
              }
            </header>

            <div id="kc-content">
              <div id="kc-content-wrapper">
                <!-- Message display -->
                @if (displayMessage && message && (message.type !== 'warning' || !isAppInitiatedAction)) {
                  <div
                    [kcClass]="'kcAlertClass'"
                    [ngClass]="message.type === 'error' ? 'pf-m-danger' : 'pf-m-' + message.type"
                    [class]="'alert-' + message.type"
                  >
                    <div class="pf-c-alert__icon">
                      @switch (message.type) {
                        @case ('success') {
                          <span [kcClass]="'kcFeedbackSuccessIcon'"></span>
                        }
                        @case ('warning') {
                          <span [kcClass]="'kcFeedbackWarningIcon'"></span>
                        }
                        @case ('info') {
                          <span [kcClass]="'kcFeedbackInfoIcon'"></span>
                        }
                        @case ('error') {
                          <span [kcClass]="'kcFeedbackErrorIcon'"></span>
                        }
                      }
                    </div>
                    <span
                      [kcClass]="'kcAlertTitleClass'"
                      [innerHTML]="message.summary | kcSanitize: 'html'"
                    ></span>
                  </div>
                }
                <!-- Content -->
                <ng-template #pageRef></ng-template>

                @if (!!auth && auth?.showTryAnotherWayLink) {
                  <form
                    id="kc-select-try-another-way-form"
                    method="post"
                    [action]="url?.loginAction"
                  >
                    <div [kcClass]="'kcFormGroupClass'">
                      <div [kcClass]="'kcFormGroupClass'">
                        <input
                          type="hidden"
                          name="tryAnotherWay"
                          value="on"
                        />
                        <a
                          id="try-another-way"
                          (click)="tryAnotherWay()"
                        >
                          {{ i18n.msgStr('doTryAnotherWay') }}
                        </a>
                      </div>
                    </div>
                  </form>
                }
                @let socialProviders = socialProvidersNode && socialProvidersNode();
                @if (socialProviders) {
                  <ng-container [ngTemplateOutlet]="socialProviders" />
                }
                <!-- Info display -->
                @if (displayInfo) {
                  <div
                    id="kc-info"
                    [kcClass]="'kcSignUpClass'"
                  >
                    <div>
                      @let info = infoNode && infoNode();
                      @if (info) {
                        <ng-container [ngTemplateOutlet]="info" />
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
        ...
      </div>
    </div>

    <!-- Sección derecha (imagen)-->
    <div
      style="
        width: 52%;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        overflow: hidden;
      "
    >
      <!-- Imagen de fondo -->
      <img
        [src]="backgroundPngUrl"
        alt="Background"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1"
      />
      <!-- Carousel Container -->
      <div
        style="
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(15px);
          -webkit-backdrop-filter: blur(15px);
          border-radius: 1rem;
          padding: 3rem 2rem;
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          color: white;
          max-width: 90%;
          border: 1px solid rgba(255, 255, 255, 0.3);
        "
      >
        <!-- Carousel Items -->
        <div style="width: 100%; display: flex; overflow: hidden; justify-content: center; position: relative">
          <div
            style="display: flex; transition: transform 0.5s ease; width: 300%"
            [style.transform]="'translateX(-' + currentIndex * 100 + '%)'"
          >
            <!-- Item 1 -->
            <div style="flex: 1 0 100%; display: flex; flex-direction: column; align-items: center">
              <img
                [src]="checkmarkPngUrl"
                style="width: 50%; height: auto; margin-bottom: 2rem"
                alt="gif"
              />
              <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem">
                Firma electrónica con validez digital
              </h2>
              <p style="font-size: 1.1rem; line-height: 1.5">
                Tus documentos protegidos con tecnología avanzada<br />y en cumplimiento con la norma vigente
              </p>
            </div>

            <!-- Item 2 -->
            <div style="flex: 1 0 100%; display: flex; flex-direction: column; align-items: center">
              <img
                [src]="checkmarkPngUrl"
                style="width: 50%; height: auto; margin-bottom: 2rem"
                alt="gif"
              />
              <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem">Lorem ipsum</h2>
              <p style="font-size: 1.1rem; line-height: 1.5">
                Lorem ipsum dolor sit, amet consectetur adipisicing elit.<br />Aliquam mollis luctus pellentesque.
              </p>
            </div>

            <!-- Item 3 -->
            <div style="flex: 1 0 100%; display: flex; flex-direction: column; align-items: center">
              <img
                [src]="checkmarkPngUrl"
                style="width: 50%; height: auto; margin-bottom: 2rem"
                alt="gif"
              />
              <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem">Lorem ipsum</h2>
              <p style="font-size: 1.1rem; line-height: 1.5">
                Lorem ipsum dolor sit, amet consectetur adipisicing elit.<br />Aliquam mollis luctus pellentesque.
              </p>
            </div>
          </div>
        </div>

        <!-- Carousel Indicators (actúan como botones) -->
        <div style="display: flex; gap: 0.5rem; margin-top: 2rem">
          <span
            *ngFor="let item of [0, 1, 2]; let i = index"
            (click)="goToItem(i)"
            [ngStyle]="{
              cursor: 'pointer',
              width: currentIndex === i ? '40px' : '12px',
              height: '12px',
              borderRadius: currentIndex === i ? '6px' : '50%',
              backgroundColor: currentIndex === i ? 'white' : 'rgba(255,255,255,0.7)',
              transition: 'all 0.3s',
            }"
          ></span>
        </div>
      </div>
    </div>
  </div>
}
